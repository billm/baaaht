# Web Search Example

**Assistant Delegates Web Search to Worker Agent**

This example demonstrates the Assistant Agent delegating web search operations to the Worker agent. The Assistant cannot access the web directly — all web operations are performed by the Worker.

---

## Scenario

A user asks for current information about a technology topic that requires up-to-date web search. The Assistant delegates the search to the Worker agent.

---

## Conversation Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    Web Search Delegation Flow                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  User ──▶ Orchestrator ──▶ Assistant Agent                     │
│                                  │                              │
│                                  ▼                              │
│                         LLM Gateway                             │
│                                  │                              │
│                        [needs web data]                        │
│                                  │                              │
│                                  ▼                              │
│  Assistant invokes delegate tool ──▶ Orchestrator              │
│                                          │                      │
│                                          ▼                      │
│                                    Worker Agent                 │
│                                          │                      │
│                                    [web search]                 │
│                                          │                      │
│                                    [fetches results]            │
│                                          │                      │
│                                          ▼                      │
│  Result ──▶ Orchestrator ──▶ Assistant Agent                   │
│                                  │                              │
│                                  ▼                              │
│                         LLM Gateway                             │
│                                  │                              │
│                        [synthesizes answer]                     │
│                                  │                              │
│                                  ▼                              │
│  User ◀── Orchestrator ◀── Assistant Agent                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Message Exchange

### Step 1: User sends message

**User Message:**
```json
{
  "id": "msg-001",
  "sessionId": "session-web-search",
  "content": "What are the latest features in TypeScript 5.8? Search for recent announcements.",
  "type": "MESSAGE_TYPE_USER",
  "timestamp": "2026-02-10T16:45:00Z"
}
```

### Step 2: Assistant determines delegation needed

The LLM analyzes the request and determines:
- Question asks for **latest features** → information may not be in training data
- Explicit request to **search** → requires web search
- Operation: `delegate` with `web_search`

### Step 3: Assistant calls delegate tool

**Tool Call Generated by LLM:**
```json
{
  "toolCallId": "tool-001",
  "name": "delegate",
  "input": {
    "target": "worker",
    "operation": "web_search",
    "parameters": {
      "query": "TypeScript 5.8 latest features new announcements 2026",
      "maxResults": 10
    },
    "timeout": 45000
  }
}
```

### Step 4: Worker agent executes web search

```typescript
// Worker agent receives task via Orchestrator
interface TaskConfig {
  command: 'web_search';
  arguments: [
    'TypeScript 5.8 latest features new announcements 2026',
    '--max-results=10'
  ];
  environment: {
    TASK_ID: 'task-search-001',
    SESSION_ID: 'session-web-search',
  };
  timeout: 45000;
}

// Worker performs web search and returns results
interface TaskResult {
  success: true;
  output: '{
    "results": [
      {
        "title": "TypeScript 5.8 Release Notes",
        "url": "https://devblogs.microsoft.com/typescript/announcing-typescript-5-8/",
        "snippet": "Today we are excited to announce the availability of TypeScript 5.8! This release includes improved type inference, enhanced decorator metadata, and more...",
        "publishedDate": "2026-01-15"
      },
      {
        "title": "What\\'s New in TypeScript 5.8",
        "url": "https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-8.html",
        "snippet": "Key features include: Enhanced control flow analysis, new --verbatimModuleSyntax option, performance improvements, and bug fixes...",
        "publishedDate": "2026-01-16"
      },
      // ... more results
    ],
    "query": "TypeScript 5.8 latest features",
    "totalResults": 10,
    "searchTime": 1.2
  }';
  state: TaskState.TASK_STATE_COMPLETED;
}
```

### Step 5: Assistant receives search results

```typescript
// Delegation result returned to Assistant
interface DelegateResult {
  success: true,
  taskId: 'task-search-001',
  taskState: TaskState.TASK_STATE_COMPLETED,
  data: {
    results: [
      {
        title: 'TypeScript 5.8 Release Notes',
        url: 'https://devblogs.microsoft.com/typescript/announcing-typescript-5-8/',
        snippet: 'Today we are excited to announce...',
        publishedDate: '2026-01-15'
      },
      // ... more results
    ],
    query: 'TypeScript 5.8 latest features',
    totalResults: 10,
    searchTime: 1.2,
  },
  metadata: {
    target: DelegateTarget.WORKER,
    operation: DelegateOperation.WEB_SEARCH,
    createdAt: new Date('2026-02-10T16:45:00.500Z'),
    completedAt: new Date('2026-02-10T16:45:02.000Z'),
    duration: 1500,
    agentId: 'worker-001'
  }
}
```

### Step 6: LLM synthesizes answer from search results

The LLM receives the search results and generates a comprehensive answer:

```typescript
// Tool result added to conversation
{
  "toolCallId": "tool-001",
  "content": '{"success":true,"data":{"results":[...]}}',
  "isError": false
}

// LLM generates final response based on search results
```

### Step 7: Assistant responds to user

**Assistant Response:**
```json
{
  "id": "msg-002",
  "sessionId": "session-web-search",
  "content": "Based on the latest search results, here are the key features in TypeScript 5.8:\n\n## Major New Features\n\n**1. Enhanced Type Inference**\n- Improved type narrowing in conditional branches\n- Better inference for generic functions\n- More accurate union type handling\n\n**2. Improved Decorator Metadata**\n- Enhanced decorator stage 3 implementation\n- Better type information for decorated members\n- New metadata API for reflection\n\n**3. Control Flow Analysis**\n- Refined analysis for complex conditions\n- Better handling of nullable types\n- Improved type guards in callbacks\n\n**4. Performance Improvements**\n- Faster compilation times (up to 15% faster)\n- Reduced memory usage during type checking\n- Optimized incremental builds\n\n**5. New Compiler Options**\n- `--verbatimModuleSyntax` for clearer module imports\n- Enhanced `--strict` mode checks\n- Better module resolution options\n\n## Sources\n- [TypeScript 5.8 Release Notes](https://devblogs.microsoft.com/typescript/announcing-typescript-5-8/)\n- [Official Documentation](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-8.html)\n\nWould you like me to elaborate on any of these features?",
  "type": "MESSAGE_TYPE_ASSISTANT",
  "toolCalls": [
    {
      "id": "tool-001",
      "name": "delegate",
      "input": {
        "target": "worker",
        "operation": "web_search",
        "parameters": {
          "query": "TypeScript 5.8 latest features new announcements 2026",
          "maxResults": 10
        },
        "timeout": 45000
      },
      "result": {
        "success": true,
        "data": {
          "results": [
            {
              "title": "TypeScript 5.8 Release Notes",
              "url": "https://devblogs.microsoft.com/typescript/announcing-typescript-5-8/",
              "snippet": "Today we are excited to announce...",
              "publishedDate": "2026-01-15"
            }
            // ... more results
          ],
          "query": "TypeScript 5.8 latest features",
          "totalResults": 10,
          "searchTime": 1.2
        }
      },
      "durationMs": 1500
    }
  ],
  "timestamp": "2026-02-10T16:45:03.500Z",
  "usage": {
    "inputTokens": 250,
    "outputTokens": 380,
    "totalTokens": 630
  }
}
```

---

## Session State After Conversation

```typescript
{
  id: "session-web-search",
  state: SessionState.SESSION_STATE_ACTIVE,
  messages: [
    {
      id: "msg-001",
      role: MessageRole.MESSAGE_ROLE_USER,
      content: "What are the latest features in TypeScript 5.8?...",
      timestamp: new Date("2026-02-10T16:45:00Z"),
    },
    {
      id: "msg-002",
      role: MessageRole.MESSAGE_ROLE_ASSISTANT,
      content: "Based on the latest search results, here are the key features...",
      toolCalls: [ /* ... */ ],
      timestamp: new Date("2026-02-10T16:45:03.500Z"),
    }
  ],
  metadata: {
    createdAt: new Date("2026-02-10T16:45:00Z"),
    lastActivityAt: new Date("2026-02-10T16:45:03.500Z"),
    messageCount: 2,
    totalTokens: 630,
    delegationCount: 1,
    delegationTargets: ['worker'],
  }
}
```

---

## Tool Call Details

### Web Search Operation Parameters

```typescript
interface WebSearchParams {
  query: string;           // Search query string
  maxResults?: number;     // Maximum number of results (default: 10)
  timeout?: number;        // Request timeout in milliseconds (default: 30000)
  language?: string;       // Search language code (default: 'en')
  safeSearch?: boolean;    // Enable safe search filtering (default: true)
}
```

### Search Result Format

```typescript
interface SearchResult {
  title: string;           // Result title
  url: string;            // Result URL
  snippet: string;        // Result description/snippet
  publishedDate?: string; // Publication date (ISO 8601)
  author?: string;        // Content author (if available)
  thumbnail?: string;     // Thumbnail image URL
}

interface WebSearchResponse {
  results: SearchResult[];  // Array of search results
  query: string;            // Original search query
  totalResults: number;     // Total number of results found
  searchTime: number;       // Search execution time in seconds
}
```

---

## Event Timeline

| Time | Event | Duration |
|---|---|---|
| 16:45:00.000 | User message received | — |
| 16:45:00.200 | LLM completion (generates web_search) | 200ms |
| 16:45:00.200 | Delegation to Worker (web_search) | — |
| 16:45:01.700 | Worker completes web search | 1,500ms |
| 16:45:02.000 | LLM completion (synthesizes answer) | 300ms |
| 16:45:02.000 | Response sent to user | — |
| **Total** | **End-to-end latency** | **~2 seconds** |

---

## Advanced Example: Multi-Step Research

### User Request

```
"Research the latest trends in edge computing and find three case studies
of companies implementing edge solutions in 2026."
```

### Step 1: Initial broad search

```json
{
  "toolCallId": "tool-001",
  "name": "delegate",
  "input": {
    "target": "worker",
    "operation": "web_search",
    "parameters": {
      "query": "edge computing trends 2026",
      "maxResults": 10
    },
    "timeout": 30000
  }
}
```

### Step 2: Specific case study search

```json
{
  "toolCallId": "tool-002",
  "name": "delegate",
  "input": {
    "target": "worker",
    "operation": "web_search",
    "parameters": {
      "query": "edge computing case studies 2026 company implementations",
      "maxResults": 15
    },
    "timeout": 30000
  }
}
```

### Step 3: Fetch specific articles for details

```json
{
  "toolCallId": "tool-003",
  "name": "delegate",
  "input": {
    "target": "worker",
    "operation": "web_fetch",
    "parameters": {
      "url": "https://example.com/edge-computing-case-study",
      "method": "GET"
    },
    "timeout": 15000
  }
}
```

---

## Key Observations

| Aspect | What Happened |
|---|---|
| **Tool Usage** | `delegate` tool invoked with `web_search` operation |
| **Delegation** | Single delegation to Worker agent |
| **Session Context** | Updated with conversation and summarized search results |
| **Assistant Context** | Clean — contains search results summary, not raw HTTP traffic |
| **Worker Context** | Contains full web request/response logs (isolated) |
| **Response Quality** | Synthesized from multiple search results with citations |

---

## Best Practices for Web Search Delegation

### 1. Construct Effective Queries

```typescript
// ❌ Too vague
{ query: "javascript" }

// ✅ Specific and time-bound
{ query: "JavaScript ES2024 new features release notes" }

// ❌ Overly specific (may miss results)
{ query: "exact phrase match only" }

// ✅ Balanced specificity
{ query: "React Server Components best practices 2026" }
```

### 2. Set Appropriate Timeouts

```typescript
// Quick searches (default)
{ timeout: 30000 }  // 30 seconds

// Comprehensive searches
{ timeout: 60000 }  // 1 minute

// Time-sensitive queries
{ timeout: 15000 }  // 15 seconds
```

### 3. Adjust Result Count

```typescript
// Quick lookup (few results)
{ maxResults: 5 }

// Comprehensive research (more results)
{ maxResults: 20 }

// Deep dive (maximum results)
{ maxResults: 50 }
```

### 4. Handle Empty Results

```typescript
// If initial search returns no results, try broader query
if (result.data.results.length === 0) {
  // Retry with simplified query
  const retryQuery = simplifyQuery(originalQuery);
  await delegate({ target: 'worker', operation: 'web_search', parameters: { query: retryQuery } });
}
```

---

## Error Handling Examples

### Network Error

```json
{
  "success": false,
  "taskId": "task-search-002",
  "taskState": "TASK_STATE_FAILED",
  "error": "Network error: Failed to connect to search service (timeout after 30000ms)",
  "metadata": { /* ... */ }
}
```

### No Results Found

```json
{
  "success": true,
  "taskId": "task-search-003",
  "taskState": "TASK_STATE_COMPLETED",
  "data": {
    "results": [],
    "query": "obscure query that returns nothing",
    "totalResults": 0,
    "searchTime": 0.8
  },
  "metadata": { /* ... */ }
}
```

### Rate Limited

```json
{
  "success": false,
  "taskId": "task-search-004",
  "taskState": "TASK_STATE_FAILED",
  "error": "Rate limit exceeded: Too many requests. Please retry after 60 seconds.",
  "metadata": {
    "retryAfter": 60,
    "rateLimitReset": "2026-02-10T16:46:00Z"
  }
}
```

---

## Related Examples

- [`simple-chat.md`](./simple-chat.md) — Direct response without delegation
- [`file-delegation.md`](./file-delegation.md) — File operation delegation

---

## Code Reference

See [`docs/DELEGATION.md`](../docs/DELEGATION.md) for:
- Complete web search parameter specification
- Web fetch operation for retrieving specific URLs
- Error handling and retry strategies
- Rate limiting considerations

---

**Copyright © 2026 baaaht project**
